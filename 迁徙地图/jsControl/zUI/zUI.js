(function($){$.zUI=$.zUI||{};$.zUI.emptyFn=function(){};$.zUI.asWidget=[];$.zUI.addWidget=function(sName,oSefDef){$.zUI.asWidget.push(sName);var w=$.zUI[sName]=$.zUI[sName]||{};var sPrefix="zUI"+sName;w.sFlagName=sPrefix;w.sEventName=sPrefix+"Event";w.sOptsName=sPrefix+"Opts";w.__creator=$.zUI.emptyFn;w.__destroyer=$.zUI.emptyFn;$.extend(w,oSefDef);w.fn=function(ele,opts){var jqEle=$(ele);jqEle.data(w.sOptsName,$.extend({},w.defaults,opts));jqEle.data(w.sFlagName,true);var d=w.__creator(ele);jqEle.on(jqEle.data(w.sEventName));return d};w.unfn=function(ele){w.__destroyer(ele);var jqEle=$(ele);if(jqEle.data(w.sFlagName)){jqEle.off(jqEle.data(w.sEventName));jqEle.data(w.sFlagName,false)}}};$.zUI.addWidget("draggable",{defaults:{bOffsetParentBoundary:false,oBoundary:null,fnComputePosition:null},__creator:function(ele){var jqEle=$(ele);jqEle.data($.zUI.draggable.sEventName,{mousedown:function(ev){var jqThis=$(this);var opts=jqThis.data($.zUI.draggable.sOptsName);jqThis.trigger("draggable.start");var iOffsetX=ev.pageX-this.offsetLeft;var iOffsetY=ev.pageY-this.offsetTop;function fnMouseMove(ev){var oPos={};if(opts.fnComputePosition){oPos=opts.fnComputePosition(ev,iOffsetX,iOffsetY)}else{oPos.iLeft=ev.pageX-iOffsetX;oPos.iTop=ev.pageY-iOffsetY}var oBoundary=opts.oBoundary;if(opts.bOffsetParentBoundary){var eParent=jqThis.offsetParent()[0];oBoundary={};oBoundary.iMinLeft=0;oBoundary.iMinTop=0;oBoundary.iMaxLeft=eParent.clientWidth-jqThis.outerWidth();oBoundary.iMaxTop=eParent.clientHeight-jqThis.outerHeight()}if(oBoundary){oPos.iLeft=oPos.iLeft<oBoundary.iMinLeft?oBoundary.iMinLeft:oPos.iLeft;oPos.iLeft=oPos.iLeft>oBoundary.iMaxLeft?oBoundary.iMaxLeft:oPos.iLeft;oPos.iTop=oPos.iTop<oBoundary.iMinTop?oBoundary.iMinTop:oPos.iTop;oPos.iTop=oPos.iTop>oBoundary.iMaxTop?oBoundary.iMaxTop:oPos.iTop}jqThis.css({left:oPos.iLeft,top:oPos.iTop});jqThis.find('[data-fixed="1"]').css({position:"absolute",top:Math.abs(oPos.iTop)+"px"});jqThis.find('[data-fixed="0"]').css({position:"static"});if(typeof ev.preventDefault!="undefined"){ev.preventDefault()}else{ev.returnValue=false}jqThis.trigger("draggable.move")}var oEvent={mousemove:fnMouseMove,mouseup:function(){$(document).off(oEvent);jqThis.trigger("draggable.stop")}};$(document).on(oEvent)}})}});$.zUI.addWidget("panel",{defaults:{iWheelStep:16,sBoxClassName:"zUIpanelScrollBox",sBarClassName:"zUIpanelScrollBar",wBoxClassName:"zUIpanelScrollBoxW",wBarClassName:"zUIpanelScrollBoxWBar"},__creator:function(ele){var jqThis=$(ele);var dObj=new Object();dObj.bs="1";if(jqThis.css("position")==="static"){jqThis.css("position","relative")}jqThis.css("overflow","hidden");var jqChild=jqThis.children(":first");dObj.setScroll=function(num,time,callback,proto){time=time||250;if(num<=0){num=0}if(num+jqThis.height()>jqChild.outerHeight()){num=jqChild.outerHeight()-jqThis.height()}callback=callback||function(){};jqChild.animate({top:"-"+num+"px"},time,callback)};dObj.forEle=function(ele,time,callback){var num=0;var $ele=$(ele);var bufEle=$ele[0];time=time||250;function a(emt){if(emt.parentNode==jqChild[0]){num=num+bufEle.offsetTop}else{if($(emt.parentNode).css("position")=="static"){}else{num=num+bufEle.offsetTop;bufEle=emt.parentNode}a(emt.parentNode)}}if($($ele[0].parentNode).css("position")=="static"){}else{num=num+bufEle.offsetTop;bufEle=$ele[0].parentNode}a($ele[0].parentNode);dObj.setScroll(num,time,callback)};if(jqChild.length){jqChild.css({top:0,position:"absolute",left:0,overflow:"hidden"})}else{return}function getParentNode(Obj,Arr){if(!Arr){var Arr=[]}Arr.push(Obj);if(Obj&&Obj.parentNode){getParentNode(Obj.parentNode,Arr)}return Arr}var opts=jqThis.data($.zUI.panel.sOptsName);var jqScrollBox=$("<div style='position:absolute;display:none;line-height:0;font-size: 0;'> A</div>");jqScrollBox.addClass(opts.sBoxClassName);var jqScrollBar=$("<div style='position:absolute;display:none;line-height:0;font-size: 0;'> A</div>");jqScrollBar.addClass(opts.sBarClassName);jqScrollBox.appendTo(jqThis);jqScrollBar.appendTo(jqThis);var jqScrollWbox=$("<div style='position:absolute;display:none;line-height:0;font-size: 0;'> A</div>");jqScrollWbox.addClass(opts.wBoxClassName);var jqScrollWBar=$("<div style='position:absolute;display:none;line-height:0;font-size: 0;'> A</div>");jqScrollWBar.addClass(opts.wBarClassName);jqScrollWbox.appendTo(jqThis);jqScrollWBar.appendTo(jqScrollWbox);opts.iTop=parseInt(jqScrollBox.css("top"));opts.iWidth=jqScrollBar.width();opts.iRight=parseInt(jqScrollBox.css("right"));opts.iLeft=parseInt(jqScrollBox.css("left"));jqScrollBar.on("draggable.move",function(){var opts=jqThis.data($.zUI.panel.sOptsName);fnScrollContent(jqScrollBox,jqScrollBar,jqThis,jqChild,opts.iTop,0);ele.scrollIng&&ele.scrollIng(ele);opts.scrollIng&&opts.scrollIng(ele)});function getParentTop(ele,parent){var path=getParentNode(ele);var num=0;for(var i=0;i<path.length;i++){if(path[i]==parent){return num}else{if(i==0){num=num+$(path[i]).position().top}else{if(($(path[i]).css("position")=="position"||$(path[i]).css("position")=="relative")){num=num+$(path[i]).position().top
}}}}}$.each(jqThis,function(){var THIS=this;$(THIS).on("focus","[type='text'],textarea",function(e){var maxHeight=$(THIS).children(":first").height()-$(THIS).height();if(maxHeight<0){return}if(-getParentTop(this,THIS)<parseInt($(THIS).children(":first").css("top"))-$(THIS).height()){if(getParentTop(this,THIS)>maxHeight){$(THIS).children(":first").css({top:-maxHeight+"px"})}else{$(THIS).children(":first").css({top:-getParentTop(this,THIS)+"px"})}}})});jqThis.on("scroll",function(){for(var o=-0;o<jqThis.length;o++){if(jqThis[o].scrollTop==0){return}jqThis[o].scrollTop=0}});jqScrollWBar.on("draggable.move",function(){if(jqScrollWbox.css("display")=="none"){$(this).css({top:"0"});return}var iLeft=Math.round(parseFloat($(this).css("left")));var iBoxWidth=$(this.parentNode).width();jqChild.css({left:-Math.round(iLeft/iBoxWidth*jqChild.width())+"px"});ele.scrollWIng&&ele.scrollWIng(ele);opts.scrollWIng&&opts.scrollWIng(ele)});if(typeof opts.scrollWResize!="undefined"&&opts.scrollWResize==1){$(window).on("resize",function(){jqChild.css({left:"0px"});jqScrollWBar.css({left:"0px"});ele.scrollWIng&&ele.scrollWIng(ele);opts.scrollWIng&&opts.scrollWIng(ele)})}var oEvent={mouseenter:function(){if(typeof opts.vScroll=="undefined"){fnFreshScroll();jqScrollBox.css("display","block");jqScrollBar.css("display","block")}if(typeof opts.cScroll=="undefined"){fnFreshWScroll();jqScrollWBar.css("display","block");jqScrollWbox.css("display","block")}},mouseleave:function(){jqScrollBox.css("display","none");jqScrollBar.css("display","none");jqScrollWBar.css("display","none");jqScrollWbox.css("display","none")}};if(typeof opts.mousemoveType!="undefined"&&opts.mousemoveType==true){oEvent.mousemove=function(){if(typeof opts.vScroll=="undefined"){fnFreshScroll();jqScrollBox.css("display","block");jqScrollBar.css("display","block")}if(typeof opts.cScroll=="undefined"){fnFreshWScroll();jqScrollWBar.css("display","block");jqScrollWbox.css("display","block")}}}var sMouseWheel="mousewheel";if(!("onmousewheel" in document)){sMouseWheel="DOMMouseScroll"}oEvent[sMouseWheel]=function(ev){var opts=jqThis.data($.zUI.panel.sOptsName);if(typeof opts.vScroll!="undefined"){return}var iWheelDelta=1;ev=ev.originalEvent;if(ev.wheelDelta){iWheelDelta=ev.wheelDelta/120}else{iWheelDelta=-ev.detail/3}var iMinTop=jqThis.innerHeight()-jqChild.outerHeight();if(iMinTop>0){jqChild.css("top",0);return}var iTop=parseInt(jqChild.css("top"));iTop=iTop+opts.iWheelStep*iWheelDelta;if(iTop>0){iTop=0}if(iTop<iMinTop){iTop=iMinTop}if(opts.eventStop){ev.stopPropagation()}if(!(iTop<=iMinTop||iTop>=0)){if(typeof ev.preventDefault!="undefined"){ev.preventDefault()}else{ev.returnValue=false}ev.stopPropagation()}jqChild.css("top",iTop);fnScrollContent(jqThis,jqChild,jqScrollBox,jqScrollBar,0,opts.iTop);jqChild.find('[data-fixed="1"]').css({position:"absolute",top:Math.abs(iTop)+"px"});jqChild.find('[data-fixed="0"]').css({position:"static"});ele.scrollIng&&ele.scrollIng(ele);opts.scrollIng&&opts.scrollIng(ele)};jqThis.data($.zUI.panel.sEventName,oEvent);function fnScrollContent(jqWrapper,jqContent,jqFollowWrapper,jqFlollowContent,iOffset1,iOffset2){var opts=jqThis.data($.zUI.panel.sOptsName);var rate=(parseInt(jqContent.css("top"))-iOffset1)/(jqContent.outerHeight()-jqWrapper.innerHeight());var iTop=(jqFlollowContent.outerHeight()-jqFollowWrapper.innerHeight())*rate+iOffset2;jqFlollowContent.css("top",iTop)}function fnFreshWScroll(){var iRate=jqThis.innerWidth()/jqChild.outerWidth();var iScrollBarHeight=Math.round(iRate*jqThis.innerWidth());var iScrollBoxHeight=jqThis.innerWidth();if(iRate>=1){jqScrollWbox.css("width",0);jqScrollWBar.css("width",0);return}jqScrollWbox.css("width",iScrollBoxHeight);jqScrollWBar.css("width",iScrollBarHeight);jqScrollWBar.draggable({bOffsetParentBoundary:true})}function fnFreshScroll(){var opts=jqThis.data($.zUI.panel.sOptsName);var iScrollBoxHeight=jqThis.innerHeight()-2*opts.iTop;var iRate=jqThis.innerHeight()/jqChild.outerHeight();var iScrollBarHeight=iScrollBarHeight=Math.round(iRate*iScrollBoxHeight);if(iRate>=1){jqScrollBox.css("height",0);jqScrollBar.css("height",0);return}jqScrollBox.css("height",iScrollBoxHeight);jqScrollBar.css("height",iScrollBarHeight);var oBoundary={iMinTop:opts.iTop};oBoundary.iMaxTop=iScrollBoxHeight-Math.round(iRate*iScrollBoxHeight)+opts.iTop;oBoundary.iMinLeft=jqThis.innerWidth()-opts.iWidth-opts.iRight;oBoundary.iMaxLeft=oBoundary.iMinLeft;fnScrollContent(jqThis,jqChild,jqScrollBox,jqScrollBar,0,opts.iTop);jqScrollBar.draggable({oBoundary:oBoundary})}return dObj},__destroyer:function(ele){var jqEle=$(ele);if(jqEle.data($.zUI.panel.sFlagName)){var opts=jqEle.data($.zUI.panel.sOptsName);jqEle.children("."+opts.sBoxClassName).remove();jqEle.children("."+opts.sBarClassName).remove()}}});$.each($.zUI.asWidget,function(i,widget){unWidget="un"+widget;var w={};w[widget]=function(args){var Obj=null;this.each(function(){Obj=$.zUI[widget].fn(this,args)});if(Obj&&Obj.bs=="1"){return Obj}return this};w[unWidget]=function(){this.each(function(){$.zUI[widget].unfn(this)
});return this};$.fn.extend(w)})})(jQuery);